class t{constructor(t,i){this.canvas=t,this.ctx=this.canvas.getContext("2d",{antialias:!0}),this.radius=this.canvas.width/2,this.options=i;const s=window.devicePixelRatio||1,h=2*this.radius,e=2*this.radius;this.canvas.width=h*s,this.canvas.height=e*s,this.canvas.style.width=`${h}px`,this.canvas.style.height=`${e}px`,this.ctx.scale(s,s),this.center={x:h/2,y:e/2},this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.drawBar(this.options.value),this.drawScale(),this.drawNeedle(this.options.value)}drawBar(t){const{startAngle:i,endAngle:s}=this.options;this.barWidth=this.radius/4,this.ctx.lineWidth=this.barWidth,this.ctx.beginPath(),this.ctx.arc(this.center.x,this.center.y,this.radius/1.15,this.degToRad(i),this.degToRad(s)),this.ctx.strokeStyle=this.options.empty,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(this.center.x,this.center.y,this.radius/1.15,this.degToRad(i),this.degToRad(i)),this.ctx.strokeStyle=this.options.full,this.ctx.stroke(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle=this.options.text,this.ctx.font=this.radius/13+"px Arial",this.ctx.fillText(this.options.title,this.center.x,this.center.y-.225*this.radius),this.ctx.font=this.radius/15+"px Arial",this.ctx.fillText(this.options.units,this.center.x,this.center.y-.125*this.radius),this.ctx.font=this.radius/5+"px Arial",this.ctx.fillText(t.toFixed(2),this.center.x,this.center.y+.25*this.radius)}drawScale(){const{startAngle:t,endAngle:i,min:s,max:h,ticks:e}=this.options,a=(360-Math.abs(t-i))/(10*e),n=t+90;this.ctx.font=this.radius/10+"px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.tickLength=this.radius/15,this.ctx.strokeStyle=this.options.text;for(let t=0;t<=10*e;t++){const i=t*a+n,c=t%10==0,r=c?this.tickLength:.5*this.tickLength;if(this.ctx.save(),this.ctx.translate(this.center.x,this.center.y),this.ctx.rotate(this.degToRad(i)),this.ctx.beginPath(),this.ctx.moveTo(0,-this.radius/1.375),this.ctx.lineTo(0,-this.radius/1.375+r),this.ctx.lineWidth=(c?1.7:1.1)*this.radius/150,this.ctx.stroke(),c){const i=s+t/(10*e)*(h-s);this.ctx.fillText(i.toFixed(0),0,-this.radius/1.85)}this.ctx.restore()}}drawNeedle(t){const{min:i,max:s,startAngle:h,endAngle:e}=this.options,a=h+(360-Math.abs(h-e))*((t-i)/(s-i)),n=this.center.x+(this.radius/1.6+this.barWidth/2)*Math.cos(this.degToRad(a)),c=this.center.y+(this.radius/1.6+this.barWidth/2)*Math.sin(this.degToRad(a));this.ctx.beginPath(),this.ctx.arc(this.center.x,this.center.y,this.radius/30,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(this.center.x,this.center.y),this.ctx.lineTo(n,c),this.ctx.lineWidth=1.2*this.radius/150,this.ctx.stroke()}degToRad(t){return t*Math.PI/180}setValueAnimated(t,i=.5){const s=this.options.value,{min:h,max:e}=this.options,a=Math.min(Math.max(Number(t),h),e),n=a-s,c=60*i;let r=1;const o=()=>{const t=r/c,i=n*(h=t,(h/=.5)<1?.5*Math.pow(h,3):.5*(Math.pow(h-2,3)+2))+s;var h;this.update(i),r+=1,t<1?requestAnimationFrame(o):this.options.value=a};requestAnimationFrame(o)}update(t){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight),this.drawBar(t),this.drawScale(),this.drawNeedle(t);const{startAngle:i,endAngle:s,min:h,max:e}=this.options,a=i+(360-Math.abs(i-s))*((t-h)/(e-h));this.ctx.beginPath(),this.ctx.arc(this.center.x,this.center.y,this.radius/1.15,this.degToRad(i),this.degToRad(a)),this.ctx.lineWidth=this.barWidth,this.ctx.strokeStyle=this.options.full,this.ctx.stroke()}}export{t as default};
